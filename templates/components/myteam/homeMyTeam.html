<div class="left-section">
    <div class="highlight-container">
        <div class="highlight">
            <h2>Ausentes de la Semana</h2>
            <p><strong id="weeklyAbsences">0</strong></p>
        </div>
        <div class="highlight">
            <h2>Ausentes del mes</h2>
            <p><strong id="monthlyAbsences">0</strong></p>
        </div>
    </div>
    <div class="card">
        <h2>Ausencias del Mes</h2>
        <table id="monthlyAbsencesTable" class="emails-table">
            <thead>
                <tr>
                    <th>Empleado</th>
                    <th>Fecha de ausencia</th>
                    <th>Tipo de Ausencia</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <div class="card">
        <h2>Listado de Empleados</h2>
        <table id="teamAbsencesTable" class="emails-table">
            <thead>
                <tr>
                    <th>Empleado</th>
                    <th>칔ltima Ausencia</th>
                    <th>Pr칩xima Ausencia</th>
                    <th>Ausencias en el Mes</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    

</div>

<script>
    function loadAbsencesSummary() {
        fetch("/myteam/absences-summary")
            .then(response => response.json())
            .then(data => {
                document.getElementById("weeklyAbsences").innerText = data.weekly_absences;
                document.getElementById("monthlyAbsences").innerText = data.monthly_absences;
            })
            .catch(error => console.error("Error al cargar ausencias:", error));
    }
    
    // Cargar los datos al abrir la p치gina
    document.addEventListener("DOMContentLoaded", loadAbsencesSummary);

    function loadMonthlyAbsences() {
    fetch("/myteam/monthly-absences")
        .then(response => response.json())
        .then(data => {
            let tableBody = document.querySelector("#monthlyAbsencesTable tbody");
            tableBody.innerHTML = "";  // Limpia la tabla antes de actualizar
            
            data.forEach(absence => {
                let row = `<tr>
                    <td>${absence.name}</td>
                    <td>${absence.start_date}</td>
                    <td>${absence.absence_type}</td>
                </tr>`;
                tableBody.innerHTML += row;
            });
        })
        .catch(error => console.error("Error al cargar ausencias del mes:", error));
}

// Cargar la tabla al abrir la p치gina
document.addEventListener("DOMContentLoaded", loadMonthlyAbsences);

function loadTeamAbsences() {
        fetch("/myteam/data")
            .then(response => response.json())
            .then(data => {
                let tableBody = document.querySelector("#teamAbsencesTable tbody");
                tableBody.innerHTML = ""; // Limpiar la tabla antes de actualizar
                
                data.forEach(employee => {
                    let row = `<tr>
                        <td>${employee.name}</td>
                        <td>${employee.last_absence}</td>
                        <td>${employee.next_absence}</td>
                        <td>${employee.absence_count}</td>
                        <td>
                            <button onclick="viewHistory(${employee.id})">游닆 Ver Historial</button>
                        </td>
                    </tr>`;
                    tableBody.innerHTML += row;
                });
            })
            .catch(error => console.error("Error al cargar la tabla de empleados:", error));
    }
    
    function viewHistory(employeeId) {
        alert("Aqu칤 se mostrar치 el historial del empleado ID: " + employeeId);
    }
    
    // Cargar la tabla autom치ticamente al abrir la p치gina
    document.addEventListener("DOMContentLoaded", loadTeamAbsences);
    </script>
